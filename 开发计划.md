

## 目标

**App-C** 与 **App-B** ，以及相关**小程序**

于 10 月底上线？

## 待确认事项

1. 协商 [开发流程](#开发流程), 待参与方确认.

2. 确认 可用人力资源.

3. 明确 app-c 与 app-b 内所有入口的应用功能与细节.

4. 确认 如果某应用有微信小程序与应用两个版本,功能上是否有显著区别.

5. 协商 [跨阶段协作机制](#跨端协作机制)

   

   


## 开发流程

![image-20201012033002868](assets/image-20201012033002868.png)

> 绿色为关键依赖资源:
>
> 其中的 mock 服务: 最低限度应该给到接口的参数格式,与返回格式,与一版可用假数据. 以供客户端自己搭建 mock 服务中间层.



### 参与者

具体参与者如下图所示

![image-20201012033832366](assets/image-20201012033832366.png)

## 依赖资源

### 对接人与相关资料

以下前缀均为 app-c ，app-b， 微信小程序

- PRD 
  - 具体对接人?
  - 资源地址?
- 高保真图/切图 
  - 具体对接人?
  - 资源地址?


- 接口 Mock 中间层

  - 具体对接人?
  - 资源地址 ？
- 接口与界面对应表

  - 具体对接人
- 接口实现联调时间点      

  - 具体对接人?
  - 资源地址 http://dev.linli580.com:10000/doc.html#/home
- 测试人员      

  - 具体对接人  ？
  - iOS uuid 号
  - 微信 id 号，需要邀请为体验人员
- 运营人员

  - 具体对接人 ？
- 发布小程序的微信开发者账号



>已知资源:
>
>web 端 原型： https://dp2qak.axshare.com/#id=3kyi7n&p=_wb-idx-01-001_____&g=1
>app 端 原型： https://r3hp3w.axshare.com/#id=v3gjhm&p=_ac-idx-01-009____&g=1
>app 端 PRD ： https://www.yuque.com/sinotaiyo/times/pazf38 (加入组才能看到)



### 跨阶段协作机制

**信息流协作 **

涉及到信息流版本的统一，如文档的交接，修改，确认。

**流程管理 **

涉及到项目节点管理。如测试包的分发，测试反馈等。

 

### 质量标准

#### 开发标准

移动平台兼容性 ？

android ?

iOS ?

#### 线上标准

bug 率 ？



## 协作资源

### uni 小程序服务端与产品需知

#### 离线包配置规则

约定检测升级的接口，比如：http://www.example.com/update/

#### 传入参数

| 参数名  | 类型   | 默认值 | 说明                                                         |
| :------ | :----- | :----- | :----------------------------------------------------------- |
| name    | String | ''     | 客户端读取到的应用名称，定义这个参数可以方便多个应用复用接口。 |
| version | String | ''     | 客户端读取到的版本号信息                                     |



#### 返回参数

| 参数名     | 类型    | 默认值 | 说明                                                       |
| :--------- | :------ | :----- | :--------------------------------------------------------- |
| update     | Boolean | false  | 是否有更新                                                 |
| packageUrl | String  | ''     | wgt/zip 包的下载地址，用于 wgt/zip 方式更新。              |
| appUrl     | String  | ''     | apk/ipa 包的下载地址或 AppStore 地址，用于整包升级的方式。 |

详情参考 [uni-app 官方文档](https://ask.dcloud.net.cn/article/35667)



## 里程碑输出

### app-b / app-c

#### 测试包

每完成一个业务模块，会提供一个测试的包。

统一为蒲公英的测试下载地址。（iOS  测试人员需要提供 UUID）

#### 上线

- iOS 应用： 开发人员提交到 app store，由运营人员上线
- android 应用： 开发人员将生产 apk 给到运营人员，由运营人员上线

### 小程序

#### 测试

测试人员提供，微信 id 号，开发人员在完成业务模块后，将体验测试版给到测试人员（二维码）。

#### 上线

开发人员提交小程序到微信平台，由运营人员上线



## 技术方案

业务模块入口，功能实现可能是 uniapp，纯网页链接， 微信小程序的某页 ，由[统一路由模块](#统一路由模块) 统一路由。

 

![image-20200916181921829](assets/image-20200916181921829.png)



![image-20200917131528501](assets/image-20200917131528501.png)





### 开发环境搭建

#### uni 小程序/ 微信小程序

参考 https://www.dcloud.io/hbuilderx.html

### 关键模块

#### x-engine 模块

管理各模块,负责注册发现,与注册.

#### header  uni 模块

小程序的头部需定制，定制结果未论证

应用开发方案选用 uni-sdk，x-engine 作为模块管理工具使用.

![image-20201012030405762](assets/image-20201012030405762.png)



#### 极光推送模块

按 x-engine 标准模块开发,可配置

#### 统一路由模块

以模块的形式存在，统一所有的跳转

##### 规则

- 跳 h5
  - https://..
- 跳微应用
  - appid + 路径 + 参数
- 跳 uniapp
  - appid + 路径 + 参数
- 跳 [微信小程序](https://developers.weixin.qq.com/doc/oplatform/Mobile_App/Launching_a_Mini_Program/iOS_Development_example.html)
  - userName + 路径 + 参数
- 跳原生界面
  - iOS
    - 类名 + 参数
  - android
    - 类名 + 参数

![image-20201010170737644](assets/image-20201010170737644.png)

参数:

````
{
  type: enum (native | h5 | microapp | uni | wx ),  // 类型
  uri:  string (url | appid | wx_username | 'XViewController,XActivity'), // 资源名
  path: string                         // 路径 /abc  /abc?a=
}
````

> 注： 如果 uni app 需要支持统一路由，则需要将 uni 请求代理到统一路由模块。

[跳微信小程序需知](https://developers.weixin.qq.com/doc/oplatform/Mobile_App/Launching_a_Mini_Program/Launching_a_Mini_Program.html)

**跳转规则**

1. 对于已通过认证的开放平台账号，其移动应用可以跳转至任何合法的小程序，且不限制跳转的小程序数量。
2. 对于未通过认证的开放平台账号，其移动应用仅可以跳转至同一开放平台账号下小程序。

>  注意：若移动应用未上架，则最多只能跳转小程序100次/天，用于满足调试需求。



外部需求:

参看: [opensdk 接入指南](https://developers.weixin.qq.com/doc/oplatform/Mobile_App/Access_Guide/iOS.html)



#### 广播模块

- 统一路由 uni 转发模块

  将 uni 里的统一路由的参数转到,统一路由模块处理.

  

## 功能拆解与排期

*TODO 需要将 [输入资源](#输入资源) 先确定*

### 统一的 css

由于功能入口涉及到 h5, 微应用，uniapp 的混编。

微应用与 h5,以及 uniapp 在样式上应该有一套统一的 css，来表达一些公共 UI，如按钮，弹窗。



### 各功能实现方案

#### app-c

- splash
- 登陆
- tab 四页
  - 首页
    - 各种分区
    - 功能入口 * n
  - 服务
  - 开门 （原生）
  - 商城
  - 我的



#### app-b

#### 小程序



