## x-cli

根据api模型， 生成 oc， java， js 三端统一接口。 保障了参数与返回值的一值性。

### 类型

#### 支持原生类型

| ts        | oc                | java      |
| --------- | ----------------- | --------- |
| boolean   | BOOL              | Boolean   |
| int       | NSInteger         | Integer   |
| double    | double            | Double    |
| string    | NSString          | String    |
| Array<?>  | NSArray<?>        | List<?>   |
| Map<?,?\> | NSDitionary<?,?\> | Map<?,?\> |
| Set<?>    | NSSet<?,?\>       | Set<?,?\> |

#### 支持嵌套

```
Map<string,Map<string,Map<string,Map<string,string>>>>;
```



#### 支持可选参数

```
title?:string
```



#### 支持自定义类型

```
interface InnerTitle{
  maintitle: string;
  subtitle: string;
  little: Array<Little>;
}
```



### 示例

``` ts
interface SheetDTO {
    title: string;
    itemList?: Array<Map<string,string>>;
    content?: string;
}
```



将会生成

``` objective-c
...
@interface SheetDTO: JSONModel
@property(nonatomic,copy) NSString* title;
@property(nonatomic,strong) NSArray<NSDictionary<NSString*,NSString*>*><Optional> * itemList;
@property(nonatomic,copy) NSString<Optional> * content;
@property(nonatomic,strong) CameraDTO*<Optional>  camera;
@end


@interface CameraDTO: JSONModel
@property(nonatomic,assign) bool<Optional>  allowsEditing;
@property(nonatomic,assign) bool<Optional>  savePhotosAlbum;
@property(nonatomic,assign) double<Optional>  cameraFlashMode;
@property(nonatomic,copy) NSString<Optional> * cameraDevice;
@end
... 
```



### 特殊参数

带`__xxxx__` 前后双下划线的都为系统保留参数.



```
__event__:string 
```

 oc/java 主动调用 js 的桥梁 



### 函数声明

可以指定默认参数.返回值. 将生成 native 对应类型与接口.

``` typescript
function showActionSheet(sheetDTO:SheetDTO={title:"title",itemList:["a","b","c"],content:"content"}):string {}
```



### 测试方法

测试方法直接写在函数体内即可

``` typescript
	
function showActionSheet(sheetDTO:SheetDTO={title:"title",itemList:["a","b","c"],content:"content"}){
    window.showActionSheet=()=>{
      xxxx.showActionSheet(
      )
      .then(res=>{
        document.getElementById("debug_text").innerText= res;
      })
    }

    window.showActionSheet()
}
```



### 参数可能情况



|                 | 有返回值（primitive） | 有返回值（对象） | 无返回值 |
| --------------- | --------------------- | ---------------- | -------- |
| 有参(primitive) | 支持                  | 支持             | 支持     |
| 有参(对象)      | 支持                  | 支持             | 支持     |
| 无参            | 支持                  | 支持             | 支持     |



## 完整 model.ts

``` typescript
// 命名空间
const moduleID = "com.zkty.module.xxxx";

// dto
interface SheetDTO {
  title: string;
  itemList?: Array<string>;
  content?: string;
  __event__: string;
}
interface MoreDTO {
  title: string;
}

// no args no ret
function noArgNoRet(){
    window.noArgNoRet = () => {
    xxxx
      .noArgNoRet()
      .then((res) => {
        document.getElementById("debug_text").innerText = "no args:"+res;
      });
  };

}

// no args ret primitive
function noArgRetPrimitive():string {
    window.noArgRetPrimitive = () => {
    xxxx
      .noArgRetPrimitive()
      .then((res) => {
        document.getElementById("debug_text").innerText = "primitive args:"+res;
      });
  };
}

// no args ret Object
function noArgRetSheetDTO():SheetDTO {
    window.noArgRetSheetDTO = () => {
    xxxx
      .noArgRetSheetDTO()
      .then((res) => {
        document.getElementById("debug_text").innerText = "SheetDTO args:"+res;
      });
  };
}

// have args no ret
interface HaveArgDTO{
  arg:string;
}
function haveArgNoRet(arg:HaveArgDTO={arg:"abc"}){
    window.haveArgNoRet = () => {
    xxxx
      .haveArgNoRet()
      .then((res) => {
        document.getElementById("debug_text").innerText = "no args:"+res;
      });
  };
}

// have args ret primitive
function haveArgRetPrimitive(arg:HaveArgDTO={arg:"abc"}):string {
    window.haveArgRetPrimitive = () => {
    xxxx
      .haveArgRetPrimitive()
      .then((res) => {
        document.getElementById("debug_text").innerText = "primitive args:"+res;
      });
  };
}

// have args ret Object
function haveArgRetSheetDTO(arg:HaveArgDTO={arg:"abc"}):SheetDTO {
    window.haveArgRetSheetDTO = () => {
    xxxx
      .haveArgRetSheetDTO()
      .then((res) => {
        document.getElementById("debug_text").innerText = "SheetDTO args:"+res;
      });
  };
}
```





## coge

coge 命令是用来根据已被管理的 git 文件快速生成模块。

```
pip3 install coge
```

在 x-engine-module-template 里运行 `coge -r` 生成模板源



如果你要生成 camera 的模块， 在 workspace 里运行。

```
coge x-engine-module-template xxxx:camera @:x-engine-module-camera -w
```

参数说明：

xxxx:camera                 x-engine-module-template 目录里所有的 xxxx  关键字替换成 camera。

@:x-engine-module-camera    生成的目标目录名叫 x-engine-module-camera

-w 	                     默认模板源必须是干净的 git 工程， -w 可忽略这一限制。 但如果你的文件未提交，使用了-w， 将不会出现在目标文件夹。 



